@page "/PasswordUpdate"  
@using System.ComponentModel.DataAnnotations  
@rendermode InteractiveServer  
@using BusinessLogic.Contracts  
@using Models  

<h3>Cambiar mi contraseña</h3>  
<EditForm model=@_newPassword OnValidSubmit="HandlePasswordChange" FormName="formCambiarPassword">  
    <DataAnnotationsValidator />  
    <ValidationSummary />  
    <div class="grid-container">  
        <div class="form-group">  
            <label for="newPassword">Nueva contraseña</label>  
            <InputText id="newPassword" type="password" class="form-control" @bind-Value="_newPassword.Email" />  
        </div>  

        <div class="form-group">  
            <label for="confirPassword">Confirmar contraseña</label>  
            <InputText id="confirPassword" type="password" class="form-control" @bind-Value="_newPassword.Password" />  
        </div>  

        <div class="form-group mt-3">  
            <button type="submit" class="btn btn-primary">Guardar nueva contraseña</button>  
        </div>  
    </div>  
</EditForm>  

@code {  
    [Inject]  
    private ILoginService _loginService { get; set; }  
    
    [SupplyParameterFromForm(FormName = "formCambiarPassword")]  
    private User _newPassword { get; set; } = new();  
    
    protected override void OnInitialized()  
    {  
        // Removed the invalid assignment to _loginService.  
        // _loginService is injected and should not be assigned to a User instance.  
        if (_loginService == null)  
        {  
            throw new InvalidOperationException("ILoginService is not initialized.");  
        }  
    }  

    private async Task HandlePasswordChange()  
    {  
        // if (_newPassword.PasswordChange != _newPassword.Password)  
        // {  
        //     // Aquí puedes manejar el error, por ejemplo, mostrando un mensaje al usuario  
        //     Console.WriteLine("Las contraseñas no coinciden.");  
        //     return;  
        // }  
        // Aquí iría la lógica para guardar la nueva contraseña  
        await _loginService.ChangePasswordAsync(_newPassword.Email, _newPassword.Password);
        Console.WriteLine("Contraseña válida: " + _newPassword.Password);  
    }  
}
